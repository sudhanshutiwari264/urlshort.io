<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Shortener Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #4f46e5;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      background-color: #4f46e5;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #4338ca;
    }
    pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f9ff;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>URL Shortener Test Page</h1>
  
  <div class="test-section">
    <h2>View All Links</h2>
    <button id="view-links">View All Links in localStorage</button>
    <div id="links-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>Create Test Link</h2>
    <button id="create-test-link">Create Test Link</button>
    <div id="create-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>Test Redirect</h2>
    <p>Enter a code to test:</p>
    <input type="text" id="test-code" placeholder="Enter code">
    <button id="test-redirect">Test Redirect</button>
    <div id="redirect-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>Clear All Links</h2>
    <button id="clear-links">Clear All Links</button>
    <div id="clear-result" class="result"></div>
  </div>
  
  <script>
    // Constants
    const STORAGE_KEY = 'url2025_links';
    
    // DOM Elements
    const viewLinksBtn = document.getElementById('view-links');
    const linksResult = document.getElementById('links-result');
    const createTestLinkBtn = document.getElementById('create-test-link');
    const createResult = document.getElementById('create-result');
    const testCodeInput = document.getElementById('test-code');
    const testRedirectBtn = document.getElementById('test-redirect');
    const redirectResult = document.getElementById('redirect-result');
    const clearLinksBtn = document.getElementById('clear-links');
    const clearResult = document.getElementById('clear-result');
    
    // Event Listeners
    viewLinksBtn.addEventListener('click', viewLinks);
    createTestLinkBtn.addEventListener('click', createTestLink);
    testRedirectBtn.addEventListener('click', testRedirect);
    clearLinksBtn.addEventListener('click', clearLinks);
    
    // View all links
    function viewLinks() {
      const links = getLinks();
      linksResult.innerHTML = `<pre>${JSON.stringify(links, null, 2)}</pre>`;
    }
    
    // Create a test link
    function createTestLink() {
      const testCode = 'test' + Math.floor(Math.random() * 1000);
      const longUrl = 'https://example.com/test';

      // Create the short URL using hash-based approach
      const shortUrl = window.location.origin + '/index.html#' + testCode;

      const linkObj = {
        id: Date.now().toString(36) + Math.random().toString(36).substring(2),
        urlCode: testCode,
        longUrl: longUrl,
        shortUrl: shortUrl,
        createdAt: new Date().toISOString(),
        expiresAt: null,
        clicks: 0,
        lastClickedAt: null
      };

      const links = getLinks();
      links.push(linkObj);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(links));

      createResult.innerHTML = `
        <p>Created test link:</p>
        <p>Code: <strong>${testCode}</strong></p>
        <p>Short URL: <a href="${linkObj.shortUrl}" target="_blank">${linkObj.shortUrl}</a></p>
        <p>Long URL: ${longUrl}</p>
        <p>Direct link test: <a href="index.html#${testCode}" target="_blank">index.html#${testCode}</a></p>
      `;
    }
    
    // Test redirect
    function testRedirect() {
      const code = testCodeInput.value.trim();
      if (!code) {
        redirectResult.innerHTML = '<p>Please enter a code to test</p>';
        return;
      }

      const links = getLinks();
      const link = links.find(link => link.urlCode === code);

      if (link) {
        // Create a hash-based URL for testing
        const testUrl = window.location.origin + '/index.html#' + code;

        redirectResult.innerHTML = `
          <p>Found link with code: ${code}</p>
          <p>Will redirect to: ${link.longUrl}</p>
          <p><a href="${testUrl}" target="_blank">Click to test redirect</a></p>
          <p>Direct hash test: <a href="index.html#${code}" target="_blank">index.html#${code}</a></p>
        `;
      } else {
        redirectResult.innerHTML = `<p>No link found with code: ${code}</p>`;
      }
    }
    
    // Clear all links
    function clearLinks() {
      localStorage.removeItem(STORAGE_KEY);
      clearResult.innerHTML = '<p>All links cleared from localStorage</p>';
    }
    
    // Get links from localStorage
    function getLinks() {
      const linksJson = localStorage.getItem(STORAGE_KEY);
      return linksJson ? JSON.parse(linksJson) : [];
    }
  </script>
</body>
</html>