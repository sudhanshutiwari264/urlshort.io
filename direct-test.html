<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Direct Redirect Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #4f46e5;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      background-color: #4f46e5;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #4338ca;
    }
    pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background-color: #f0f9ff;
      border-radius: 4px;
    }
    input {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>Direct Redirect Test</h1>
  
  <div class="test-section">
    <h2>Create Test Link</h2>
    <div>
      <input type="text" id="long-url" placeholder="Enter long URL (e.g., https://example.com)" value="https://example.com">
      <input type="text" id="code" placeholder="Enter code (e.g., test123)" value="test123">
      <button id="create-btn">Create Link</button>
    </div>
    <div id="create-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>View All Links</h2>
    <button id="view-btn">View Links</button>
    <div id="view-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>Test Redirect</h2>
    <div>
      <input type="text" id="test-code" placeholder="Enter code to test" value="test123">
      <button id="test-btn">Test Redirect</button>
    </div>
    <div id="test-result" class="result"></div>
  </div>
  
  <div class="test-section">
    <h2>Clear All Links</h2>
    <button id="clear-btn">Clear All Links</button>
    <div id="clear-result" class="result"></div>
  </div>
  
  <script>
    // Constants
    const STORAGE_KEY = 'url2025_links';
    
    // DOM Elements
    const longUrlInput = document.getElementById('long-url');
    const codeInput = document.getElementById('code');
    const createBtn = document.getElementById('create-btn');
    const createResult = document.getElementById('create-result');
    const viewBtn = document.getElementById('view-btn');
    const viewResult = document.getElementById('view-result');
    const testCodeInput = document.getElementById('test-code');
    const testBtn = document.getElementById('test-btn');
    const testResult = document.getElementById('test-result');
    const clearBtn = document.getElementById('clear-btn');
    const clearResult = document.getElementById('clear-result');
    
    // Event Listeners
    createBtn.addEventListener('click', createLink);
    viewBtn.addEventListener('click', viewLinks);
    testBtn.addEventListener('click', testRedirect);
    clearBtn.addEventListener('click', clearLinks);
    
    // Create a link
    function createLink() {
      const longUrl = longUrlInput.value.trim();
      const code = codeInput.value.trim();
      
      if (!longUrl || !code) {
        createResult.innerHTML = '<p>Please enter both a long URL and a code</p>';
        return;
      }
      
      // Create the link object
      const linkObj = {
        id: Date.now().toString(),
        urlCode: code,
        longUrl: longUrl,
        shortUrl: window.location.origin + '/' + code,
        createdAt: new Date().toISOString(),
        expiresAt: null,
        clicks: 0,
        lastClickedAt: null
      };
      
      // Get existing links
      const links = getLinks();
      
      // Check if code already exists
      const existingLink = links.find(link => link.urlCode === code);
      if (existingLink) {
        createResult.innerHTML = '<p>This code is already in use. Please choose another code.</p>';
        return;
      }
      
      // Add the new link
      links.push(linkObj);
      
      // Save to localStorage
      localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
      
      // Show result
      createResult.innerHTML = `
        <p>Link created successfully!</p>
        <p>Short URL: <a href="${linkObj.shortUrl}" target="_blank">${linkObj.shortUrl}</a></p>
        <p>Code: ${code}</p>
        <p>Long URL: ${longUrl}</p>
      `;
    }
    
    // View all links
    function viewLinks() {
      const links = getLinks();
      
      if (links.length === 0) {
        viewResult.innerHTML = '<p>No links found in localStorage</p>';
        return;
      }
      
      viewResult.innerHTML = `<pre>${JSON.stringify(links, null, 2)}</pre>`;
    }
    
    // Test redirect
    function testRedirect() {
      const code = testCodeInput.value.trim();
      
      if (!code) {
        testResult.innerHTML = '<p>Please enter a code to test</p>';
        return;
      }
      
      const links = getLinks();
      const link = links.find(link => link.urlCode === code);
      
      if (!link) {
        testResult.innerHTML = '<p>No link found with this code</p>';
        return;
      }
      
      testResult.innerHTML = `
        <p>Link found!</p>
        <p>Code: ${link.urlCode}</p>
        <p>Long URL: ${link.longUrl}</p>
        <p>Short URL: ${link.shortUrl}</p>
        <p><a href="${link.shortUrl}" target="_blank">Click to test redirect</a></p>
        <p>Direct test: <a href="/redirect.html?code=${link.urlCode}" target="_blank">Test via redirect.html</a></p>
      `;
    }
    
    // Clear all links
    function clearLinks() {
      localStorage.removeItem(STORAGE_KEY);
      clearResult.innerHTML = '<p>All links cleared from localStorage</p>';
    }
    
    // Get links from localStorage
    function getLinks() {
      const linksJson = localStorage.getItem(STORAGE_KEY);
      return linksJson ? JSON.parse(linksJson) : [];
    }
  </script>
</body>
</html>